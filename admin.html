<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PALADO åå°ç®¡ç†ç³»ç»Ÿ</title>
    <!-- å›¾æ ‡åº“ -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <style>
        :root {
            --primary: #7380ec;
            --dark: #363949;
            --light: #f6f6f9;
            --white: #fff;
            --gray: #7d8da1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: sans-serif;
        }

        body {
            background: var(--light);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* === 1. ç™»å½•æ¡†æ ·å¼ === */
        .login-container {
            background: var(--white);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            width: 350px;
            text-align: center;
        }

        .login-container h2 {
            margin-bottom: 20px;
            color: var(--dark);
        }

        .login-input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            outline: none;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
        }

        .login-btn:hover {
            background: #5a67d8;
        }

        /* === 2. åå°ä¸»ç•Œé¢æ ·å¼ (é»˜è®¤éšè—) === */
        #dashboard-view {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: row;
        }

        aside {
            width: 250px;
            background: var(--white);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        aside h2 {
            margin-bottom: 30px;
            color: var(--dark);
            text-align: center;
        }

        aside button {
            background: none;
            border: none;
            padding: 10px;
            cursor: pointer;
            text-align: left;
            color: var(--gray);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        aside button:hover {
            color: var(--primary);
        }

        main {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table-box {
            background: var(--white);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 15px;
            color: var(--dark);
            border-bottom: 1px solid #eee;
        }

        td {
            padding: 15px;
            color: var(--gray);
            border-bottom: 1px solid #eee;
        }

        /* çŠ¶æ€æ ‡ç­¾ */
        .status {
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: white;
        }

        .status.Paid {
            background: #41f1b6;
        }

        .status.Pending {
            background: #ffbb55;
        }

        /* ç®€å•è¡¨å• */
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }

        .form-row input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex: 1;
        }
    </style>
</head>

<body>

    <!-- ğŸ”’ 1. ç™»å½•ç•Œé¢ -->
    <div id="login-view" class="login-container">
        <h2>ğŸ”’ ç®¡ç†å‘˜ç™»å½•</h2>
        <input type="text" id="username" class="login-input" placeholder="è´¦å· (admin)">
        <input type="password" id="password" class="login-input" placeholder="å¯†ç  (123456)">
        <button class="login-btn" onclick="handleLogin()">ç™» å½•</button>
        <p style="margin-top:15px; font-size:0.8rem; color:#999;" id="login-msg">è¯·è¾“å…¥è´¦å·å¯†ç </p>
    </div>

    <!-- ğŸ“Š 2. åå°ä¸»ç•Œé¢ -->
    <div id="dashboard-view">
        <aside>
            <h2>PALADO ADMIN</h2>
            <button onclick="loadOrders()"><span class="material-icons-sharp">receipt_long</span> è®¢å•ç®¡ç†</button>
            <button onclick="loadProducts()"><span class="material-icons-sharp">inventory_2</span> å•†å“åº“å­˜</button>
            <button onclick="logout()"><span class="material-icons-sharp">logout</span> é€€å‡ºç™»å½•</button>
        </aside>

        <main>
            <div class="header">
                <h1>æ§åˆ¶å°</h1>
                <h3 id="welcome-msg">æ¬¢è¿å›æ¥</h3>
            </div>

            <!-- ä¸Šæ¶å•†å“åŒºåŸŸ -->
            <div class="form-row">
                <input id="p-name" placeholder="å•†å“å">
                <input id="p-price" type="number" placeholder="ä»·æ ¼">
                <input id="p-img" placeholder="å›¾ç‰‡é“¾æ¥">
                <button class="login-btn" style="width: auto;" onclick="addProduct()">â• ä¸Šæ¶</button>
            </div>

            <!-- æ•°æ®è¡¨æ ¼åŒºåŸŸ -->
            <div class="table-box">
                <h2 style="margin-bottom:20px;">æ•°æ®åˆ—è¡¨</h2>
                <table id="data-table">
                    <thead>
                        <tr>
                            <th>å†…å®¹</th>
                            <th>è¯¦æƒ…</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- JS å¡«å…… -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <script>
        // ================= é…ç½® =================
        // âš ï¸ è¯·ç¡®è®¤è¿™æ˜¯ä½ çš„ Render åç«¯åœ°å€
        const API_URL = 'https://palado-backend1.onrender.com/api';

        // æ£€æŸ¥æœ‰æ²¡æœ‰å­˜è¿‡çš„ä»¤ç‰Œ
        let token = localStorage.getItem('admin_token');

        // ================= å¯åŠ¨é€»è¾‘ =================
        if (token) {
            showDashboard();
        } else {
            document.getElementById('login-view').style.display = 'block';
        }

        // ================= 1. ç™»å½•åŠŸèƒ½ =================
        async function handleLogin() {
            const user = document.getElementById('username').value;
            const pass = document.getElementById('password').value;
            const msg = document.getElementById('login-msg');

            msg.innerText = "æ­£åœ¨è¿æ¥...";

            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: user, password: pass })
                });

                const data = await res.json();

                if (res.ok) {
                    // ç™»å½•æˆåŠŸï¼
                    token = data.token;
                    localStorage.setItem('admin_token', token); // å­˜åˆ°æµè§ˆå™¨
                    showDashboard();
                } else {
                    msg.innerText = "âŒ " + (data.error || "ç™»å½•å¤±è´¥");
                    msg.style.color = "red";
                }
            } catch (err) {
                msg.innerText = "âŒ æ— æ³•è¿æ¥æœåŠ¡å™¨";
                console.error(err);
            }
        }

        // ================= 2. åˆ‡æ¢ç•Œé¢ =================
        function showDashboard() {
            document.getElementById('login-view').style.display = 'none';
            document.getElementById('dashboard-view').style.display = 'flex';
            loadOrders(); // é»˜è®¤åŠ è½½è®¢å•
        }

        function logout() {
            localStorage.removeItem('admin_token');
            location.reload(); // åˆ·æ–°é¡µé¢å›åˆ°ç™»å½•é¡µ
        }

        // ================= 3. è·å–è®¢å• =================
        async function loadOrders() {
            try {
                const res = await fetch(`${API_URL}/orders`, {
                    headers: { 'Authorization': token } // ğŸ”‘ å¸¦ç€ä»¤ç‰Œå»æ•²é—¨
                });

                if (res.status === 401) return logout(); // ä»¤ç‰Œè¿‡æœŸï¼Œè¸¢å‡ºå»

                const orders = await res.json();
                renderTable(orders, 'order');
            } catch (err) { alert("åŠ è½½å¤±è´¥"); }
        }

        // ================= 4. è·å–å•†å“ =================
        async function loadProducts() {
            try {
                const res = await fetch(`${API_URL}/products`);
                const products = await res.json();
                renderTable(products, 'product');
            } catch (err) { alert("åŠ è½½å¤±è´¥"); }
        }

        // ================= 5. ä¸Šæ¶å•†å“ =================
        async function addProduct() {
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const img = document.getElementById('p-img').value;

            if (!name || !price) return alert("è¯·å¡«å†™å®Œæ•´");

            const res = await fetch(`${API_URL}/products`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': token // ğŸ”‘ éœ€è¦ä»¤ç‰Œæ‰èƒ½ä¸Šæ¶
                },
                body: JSON.stringify({ name, price, img })
            });

            if (res.ok) {
                alert("ä¸Šæ¶æˆåŠŸ");
                loadProducts(); // åˆ·æ–°åˆ—è¡¨
            } else {
                alert("ä¸Šæ¶å¤±è´¥");
            }
        }

        // ================= 6. æ¸²æŸ“è¡¨æ ¼å·¥å…· =================
        function renderTable(data, type) {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            data.forEach(item => {
                let html = '';
                if (type === 'order') {
                    // è®¢å•è¡Œ
                    html = `
                        <td><strong>${item.customerName || 'åŒ¿å'}</strong><br>${item.date ? new Date(item.date).toLocaleDateString() : ''}</td>
                        <td>${item.items ? item.items.length : 1} ä»¶å•†å“<br><span style="color:#7380ec">$${item.totalPrice}</span></td>
                        <td><span class="status Paid">å·²ä»˜æ¬¾</span></td>
                    `;
                } else {
                    // å•†å“è¡Œ
                    html = `
                        <td><img src="${item.img}" style="width:50px;height:50px;border-radius:5px;object-fit:cover;"></td>
                        <td><strong>${item.name}</strong><br>$${item.price}</td>
                        <td><button onclick="deleteItem('${item._id}')" style="color:red;border:none;background:none;cursor:pointer;">åˆ é™¤</button></td>
                    `;
                }
                tbody.innerHTML += `<tr>${html}</tr>`;
            });
        }

        // ä¸‹æ¶åŠŸèƒ½
        async function deleteItem(id) {
            if (!confirm("ç¡®å®šåˆ é™¤å—ï¼Ÿ")) return;
            await fetch(`${API_URL}/products/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': token }
            });
            loadProducts();
        }
    </script>
</body>

</html>
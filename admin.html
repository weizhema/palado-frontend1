<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PALADO DASHBOARD</title>
    <!-- å¼•å…¥å›¾è¡¨åº“å’Œå›¾æ ‡åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    <style>
        :root {
            --color-primary: #7380ec;
            --color-danger: #ff7782;
            --color-success: #41f1b6;
            --color-white: #fff;
            --color-info-dark: #7d8da1;
            --color-dark: #363949;
            --color-light: rgba(132, 139, 200, 0.18);
            --card-border-radius: 2rem;
            --card-padding: 1.8rem;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f6f6f9;
            color: var(--color-dark);
            margin: 0;
            padding: 0;
            display: flex;
        }

        /* ä¾§è¾¹æ  */
        aside {
            height: 100vh;
            background: var(--color-white);
            padding: 20px;
            width: 250px;
            position: fixed;
            display: flex;
            flex-direction: column;
            gap: 30px;
            box-shadow: 1px 0 10px rgba(0, 0, 0, 0.1);
        }

        aside h2 {
            margin-bottom: 20px;
            color: var(--color-dark);
        }

        aside a {
            display: flex;
            gap: 1rem;
            color: var(--color-info-dark);
            text-decoration: none;
            padding: 1rem;
            transition: 0.3s;
            border-radius: 10px;
        }

        aside a:hover,
        aside a.active {
            background: var(--color-light);
            color: var(--color-primary);
        }

        aside a span {
            font-size: 1.6rem;
        }

        /* ä¸»ä½“å†…å®¹ */
        main {
            margin-left: 270px;
            padding: 2rem;
            width: 100%;
        }

        /* æ•°æ®å¡ç‰‡ */
        .insights {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.6rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--color-white);
            padding: var(--card-padding);
            border-radius: var(--card-border-radius);
            box-shadow: 0 2rem 3rem var(--color-light);
        }

        .card h3 {
            font-size: 1rem;
            color: var(--color-dark);
        }

        .card h1 {
            margin-top: 10px;
        }

        /* å¸ƒå±€ç½‘æ ¼ */
        .grid-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table-card {
            background: var(--color-white);
            border-radius: var(--card-border-radius);
            padding: var(--card-padding);
            box-shadow: 0 2rem 3rem var(--color-light);
            margin-bottom: 2rem;
        }

        table {
            width: 100%;
            text-align: left;
            border-collapse: collapse;
        }

        th {
            padding-bottom: 1rem;
            color: var(--color-dark);
        }

        td {
            padding: 1rem 0;
            border-bottom: 1px solid var(--color-light);
            color: var(--color-info-dark);
        }

        .status {
            padding: 5px 10px;
            border-radius: 15px;
            color: #fff;
            font-size: 0.8rem;
        }

        .status.Pending {
            background: #ffbb55;
        }

        .status.Shipped {
            background: var(--color-success);
        }

        /* ç®€å•çš„ä¸Šæ¶è¡¨å• */
        .add-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        input {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: #fff;
            padding: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            grid-column: span 2;
        }
    </style>
</head>

<body>

    <!-- å·¦ä¾§èœå• -->
    <aside>
        <h2>PALADO <span style="color:var(--color-danger)">ADMIN</span></h2>
        <a href="#" class="active">
            <span class="material-icons-sharp">grid_view</span>
            <h3>ä»ªè¡¨ç›˜</h3>
        </a>
        <a href="#orders">
            <span class="material-icons-sharp">receipt_long</span>
            <h3>è®¢å•ç®¡ç†</h3>
        </a>
        <a href="#products">
            <span class="material-icons-sharp">inventory</span>
            <h3>åº“å­˜ç®¡ç†</h3>
        </a>
        <a href="index.html">
            <span class="material-icons-sharp">logout</span>
            <h3>è¿”å›å•†åŸ</h3>
        </a>
    </aside>

    <!-- å³ä¾§å†…å®¹ -->
    <main>
        <h1>æ§åˆ¶å°æ¦‚è§ˆ</h1>

        <!-- 1. é¡¶éƒ¨æ•°æ®å¡ç‰‡ -->
        <div class="insights">
            <div class="card">
                <span class="material-icons-sharp"
                    style="background:coral; color:#fff; padding:5px; border-radius:50%">analytics</span>
                <h3>æ€»é”€å”®é¢</h3>
                <h1>$12,450</h1>
            </div>
            <div class="table-card" style="margin-bottom: 20px;">
                <h2>ğŸ“Š è®¢å•åˆ†æ</h2>
                <div style="height: 300px; display: flex; justify-content: center;">
                    <canvas id="orderChart"></canvas>
                </div>
            </div>
            <div class="card">
                <span class="material-icons-sharp"
                    style="background:lightgreen; color:#fff; padding:5px; border-radius:50%">shopping_cart</span>
                <h3>æ€»è®¢å•æ•°</h3>
                <h1 id="total-orders">0</h1>
            </div>
            <div class="card">
                <span class="material-icons-sharp"
                    style="background:skyblue; color:#fff; padding:5px; border-radius:50%">inventory</span>
                <h3>åœ¨å”®å•†å“</h3>
                <h1 id="total-products">0</h1>
            </div>
        </div>

        <div class="grid-container">
            <!-- 2. æœ€è¿‘è®¢å•åˆ—è¡¨ -->
            <div class="table-card">
                <h2>æœ€è¿‘è®¢å•</h2>
                <table>
                    <thead>
                        <tr>
                            <th>é¡¾å®¢</th>
                            <th>è´­ä¹°å•†å“</th>
                            <th>é‡‘é¢</th>
                            <th>çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="order-list">
                        <!-- JS å¡«å…… -->
                    </tbody>
                </table>
            </div>

            <!-- 3. ä¸Šæ¶æ–°äº§å“ (ç®€å•ç‰ˆ) -->
            <div class="table-card">
                <h2>å¿«é€Ÿä¸Šæ¶</h2>
                <div class="add-form">
                    <input type="text" id="p-name" placeholder="äº§å“åç§°">
                    <input type="number" id="p-price" placeholder="ä»·æ ¼">
                    <input type="text" id="p-img" placeholder="å›¾ç‰‡URL" style="grid-column: span 2">
                    <button class="btn-primary" onclick="addProduct()">ç«‹å³å‘å¸ƒ</button>
                </div>
            </div>
        </div>

        <!-- 4. äº§å“åˆ—è¡¨ -->
        <div class="table-card">
            <h2>åº“å­˜åˆ—è¡¨</h2>
            <table>
                <thead>
                    <tr>
                        <th>å›¾ç‰‡</th>
                        <th>åç§°</th>
                        <th>ä»·æ ¼</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="product-list"></tbody>
            </table>
        </div>
    </main>

    <script>
        // ç®€æ˜“ä»¤ç‰Œæ£€æŸ¥
        const token = localStorage.getItem('admin_token');
        if (!token) {
            alert("æ‚¨æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•ï¼");
            window.location.href = "login.html";
        }
        const SECRET_KEY = "palado_admin_888"; // ä½ è‡ªå·±è®¾å®šçš„å¯†ç 
        const userKey = localStorage.gj_token;

        if (userKey !== SECRET_KEY) {
            const input = prompt("è¯·è¾“å…¥ç®¡ç†å‘˜å¯†é’¥ï¼š");
            if (input === SECRET_KEY) {
                localStorage.gj_token = input;
            } else {
                alert("æ— æƒè®¿é—®ï¼");
                window.location.href = "index.html"; // è¸¢å›é¦–é¡µ
            }
        }
        const API_URL = 'https://palado-backend1.onrender.com';

        // åˆå§‹åŒ–åŠ è½½
        async function init() {
            fetchOrders();
            fetchProducts();
        }

        // è·å–è®¢å•
        async function fetchOrders() {
            const res = await fetch(`${API_URL}/orders`, {
                headers: { 'Authorization': token } // ğŸ‘ˆ åŠ ä¸Šè¿™è¡Œ
            });
            if (res.status === 401) window.location.href = "login.html"; // Token è¿‡æœŸè¸¢å‡ºå»
            const orders = await res.json();

            document.getElementById('total-orders').innerText = orders.length;

            const html = orders.map(order => `
                <tr>
                    <td>${order.customerName}</td>
                    <td>${order.product}</td>
                    <td>$${order.amount}</td>
                    <td><span class="status ${order.status}">${order.status}</span></td>
                </tr>
            `).join('');
            document.getElementById('order-list').innerHTML = html;
            // ================= æ–°å¢ï¼šæ¸²æŸ“å›¾è¡¨ =================
            // 1. ç»Ÿè®¡æ•°æ®ï¼šç®—å‡ºæœ‰å¤šå°‘ä¸ª Pendingï¼Œå¤šå°‘ä¸ª Shipped
            const pendingCount = orders.filter(o => o.status === 'Pending').length;
            const shippedCount = orders.filter(o => o.status === 'Shipped').length;

            // 2. é”€æ¯æ—§å›¾è¡¨ (é˜²æ­¢åˆ·æ–°æ—¶é‡å )
            if (window.myChart) window.myChart.destroy();

            // 3. ç”»æ–°å›¾
            const ctx = document.getElementById('orderChart').getContext('2d');
            window.myChart = new Chart(ctx, {
                type: 'doughnut', // ç”œç”œåœˆå›¾
                data: {
                    labels: ['å¾…å¤„ç† (Pending)', 'å·²å‘è´§ (Shipped)'],
                    datasets: [{
                        data: [pendingCount, shippedCount],
                        backgroundColor: ['#ffbb55', '#41f1b6'], // é»„è‰²å’Œç»¿è‰²
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

        // è·å–äº§å“
        async function fetchProducts() {
            const res = await fetch(`${API_URL}/products`, {
                headers: { 'Authorization': token } // ğŸ‘ˆ åŠ ä¸Šè¿™è¡Œ
            });
            if (res.status === 401) window.location.href = "login.html"; // Token è¿‡æœŸè¸¢å‡ºå»
            const products = await res.json();

            document.getElementById('total-products').innerText = products.length;

            const html = products.map(p => `
                <tr>
                    <td><img src="${p.img}" style="width:40px;height:40px;border-radius:5px;object-fit:cover"></td>
                    <td>${p.name}</td>
                    <td>$${p.price}</td>
                    <td style="color:red;cursor:pointer" onclick="deleteProduct('${p._id}')">ä¸‹æ¶</td>
                </tr>
            `).join('');
            document.getElementById('product-list').innerHTML = html;
        }

        // ä¸Šæ¶äº§å“
        async function addProduct() {
            const name = document.getElementById('p-name').value;
            const price = document.getElementById('p-price').value;
            const img = document.getElementById('p-img').value;

            await fetch(`${API_URL}/products`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, price, img })
            });
            alert("ä¸Šæ¶æˆåŠŸï¼");
            fetchProducts();
        }

        // ä¸‹æ¶äº§å“
        async function deleteProduct(id) {
            if (!confirm("ç¡®å®šä¸‹æ¶ï¼Ÿ")) return;
            await fetch(`${API_URL}/products/${id}`, { method: 'DELETE' });
            fetchProducts();
        }

        init();
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PALADO | æœªæ¥å±¥ç¨‹</title>
    <!-- å¼•å…¥æ¼‚äº®çš„å­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <!-- å¼•å…¥ Stripe å®˜æ–¹ JS åº“ -->
    <script src="https://js.stripe.com/v3/"></script>
    <!-- ==================== è¿™é‡Œæ˜¯ CSS æ ·å¼åŒºåŸŸ ==================== -->
    <style>
        /* å…¨å±€é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #fdfbf7;
            /* æš–ç±³è‰²èƒŒæ™¯ */
            color: #1a1a1a;
        }

        /* å¯¼èˆªæ  */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            position: fixed;
            width: 100%;
            top: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            z-index: 100;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .logo {
            font-weight: 800;
            font-size: 1.5rem;
            letter-spacing: -1px;
        }

        .nav-links {
            list-style: none;
            display: flex;
            gap: 30px;
        }


        .nav-links a {
            text-decoration: none;
            color: #666;
            font-weight: 500;
        }

        .nav-links a.active {
            color: #000;
            font-weight: 800;
        }

        .nav-right {
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* ... åŸæœ‰çš„ .nav-links ... */

        /* æ–°å¢ï¼šæœç´¢æ¡†æ ·å¼ */
        .search-box {
            display: flex;
            align-items: center;
            background: #f5f5f5;
            padding: 5px 15px;
            border-radius: 20px;
            margin-right: 20px;
        }

        .search-box input {
            border: none;
            background: transparent;
            outline: none;
            font-size: 0.9rem;
            width: 150px;
        }

        .search-box i {
            color: #999;
        }

        /* ç»™åˆ†ç±»æŒ‰é’®åŠ ä¸ªé¼ æ ‡æ ·å¼ï¼Œè®©äººçŸ¥é“èƒ½ç‚¹ */
        .nav-links li a {
            cursor: pointer;
            transition: color 0.3s;
        }

        /* è‹±é›„åŒº */
        .hero {
            height: 60vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            background: linear-gradient(to bottom, #fdfbf7, #fff);
            padding-top: 60px;
        }

        .hero h1 {
            font-size: 4rem;
            line-height: 1.1;
            margin-bottom: 15px;
        }

        .hero p {
            font-size: 1.2rem;
            color: #666;
        }

        /* äº§å“åŒºåŸŸ */
        .products-section {
            padding: 50px 5%;
            min-height: 500px;
            /* ä¿è¯æ²¡æ•°æ®æ—¶ä¹Ÿæœ‰é«˜åº¦ */
        }

        .section-header {
            text-align: center;
            margin-bottom: 50px;
        }

        .section-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        /* âš ï¸ å…³é”®å¸ƒå±€ï¼šç½‘æ ¼ç³»ç»Ÿ */
        .product-grid {
            display: grid;
            /* è‡ªåŠ¨é€‚åº”å±å¹•å®½åº¦ï¼Œæœ€çª„ 280px */
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 40px;
            min-height: 200px;
        }

        /* äº§å“å¡ç‰‡æ ·å¼ */
        .product-card {
            background: #fff;
            border-radius: 15px;
            padding: 15px;
            transition: transform 0.3s ease;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .product-card:hover {
            transform: translateY(-10px);
            /* æ‚¬åœä¸Šæµ® */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .product-card img {
            background-color: #f5f5f5;
            /* é˜²æ­¢å›¾ç‰‡åŠ è½½å¤±è´¥æ˜¯ä¸€ç‰‡ç™½ */
        }

        /* é¡µè„š */
        footer {
            text-align: center;
            padding: 50px;
            color: #999;
            font-size: 0.8rem;
            border-top: 1px solid #eee;
            margin-top: 50px;
        }

        /* ============ è´­ç‰©è½¦æ ·å¼ ============ */
        /* ä¾§è¾¹æ ä¸»ä½“ */
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            /* é»˜è®¤è—åœ¨å±å¹•å³è¾¹å¤–é¢ */
            width: 350px;
            height: 100%;
            background: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            transition: right 0.3s ease;
            /* é¡ºæ»‘åŠ¨ç”» */
            display: flex;
            flex-direction: column;
        }

        /* æ¿€æ´»çŠ¶æ€ï¼šæ»‘å‡ºæ¥ */
        .cart-sidebar.open {
            right: 0;
        }

        .cart-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-items {
            flex: 1;
            /* å æ®ä¸­é—´æ‰€æœ‰ç©ºé—´ */
            overflow-y: auto;
            /* å†…å®¹å¤šäº†å¯ä»¥æ»šåŠ¨ */
            padding: 20px;
        }

        /* è´­ç‰©è½¦é‡Œçš„æ¯ä¸€ä¸ªå°å•†å“ */
        .cart-item {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #f5f5f5;
            padding-bottom: 10px;
        }

        .cart-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 10px;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-remove {
            color: #ff4444;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .cart-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            background: #fafafa;
        }

        .total-price {
            display: flex;
            justify-content: space-between;
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .checkout-btn {
            width: 100%;
            padding: 15px;
            background: #000;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
        }

        /* é®ç½©å±‚ */
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
            /* é»˜è®¤ä¸æ˜¾ç¤º */
        }

        .cart-overlay.open {
            display: block;
        }
    </style>
</head>

<body>
    <!-- 1. é¡¶éƒ¨é€šçŸ¥æ  -->
    <div class="announcement-bar">
        <p>ğŸ‰ æ–°äººé¦–å•ç«‹å‡ $20 | å…¨åœºæ»¡ $150 å…è¿è´¹ ğŸšš</p>
    </div>
    <!-- 1. å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="logo">PALADO.</div>

        <!-- æœç´¢æ¡† -->
        <div class="search-box">
            <span style="margin-right:5px">ğŸ”</span>
            <input type="text" id="search-input" placeholder="æœç´¢é‹æ¬¾..." oninput="handleSearch()">
        </div>

        <ul class="nav-links">
            <!-- æ³¨æ„ï¼šonclick é‡Œé¢è°ƒç”¨äº† filterProducts å‡½æ•° -->
            <li><a onclick="filterProducts('all')" class="active" id="btn-all">å…¨éƒ¨</a></li>
            <li><a onclick="filterProducts('running')" id="btn-running">è·‘æ­¥</a></li>
            <li><a onclick="filterProducts('casual')" id="btn-casual">ä¼‘é—²</a></li>
        </ul>

        <div class="nav-right">
            <span>CART (0)</span>
        </div>
    </nav>

    <!-- 2. è‹±é›„æµ·æŠ¥åŒº -->
    <header class="hero">
        <div class="hero-content">
            <h1>é‡å¡‘<br>ä½ çš„æ­¥ä¼</h1>
            <p>Design for movement. Engineered for speed.</p>
        </div>
    </header>

    <!-- 3. äº§å“å±•ç¤ºåŒº (å…³é”®åŒºåŸŸ) -->
    <section class="products-section">
        <div class="section-header">
            <h2>ç²¾é€‰ç³»åˆ—</h2>
            <p>2025 æ˜¥å­£æ–°æ¬¾</p>
        </div>

        <!-- âš ï¸ å…³é”®ç‚¹ï¼šè¿™ä¸ª ID å¿…é¡»å« product-gridï¼ŒJS æ‰èƒ½æ‰¾åˆ°å®ƒ -->
        <div id="product-grid" class="product-grid">
            <!-- æ­£åœ¨åŠ è½½æ—¶çš„å ä½ç¬¦ -->
            <div style="grid-column: 1/-1; text-align: center; padding: 50px; color: #999;">
                <p>â³ æ­£åœ¨å‘¼å«åç«¯ä»“åº“...</p>
            </div>
        </div>
    </section>

    <!-- 4. é¡µè„š -->
    <footer>
        <p>Â© 2025 PALADO SHOES.</p>
    </footer>

    <!-- ğŸ›’ è´­ç‰©è½¦ä¾§è¾¹æ  (é»˜è®¤éšè—) -->
    <div id="cart-sidebar" class="cart-sidebar">
        <div class="cart-header">
            <h2>ä½ çš„è´­ç‰©è½¦</h2>
            <button onclick="toggleCart()" class="close-btn">&times;</button>
        </div>

        <!-- è´­ç‰©è½¦é‡Œçš„åˆ—è¡¨ -->
        <div id="cart-items" class="cart-items">
            <!-- JS ä¼šæŠŠå•†å“å¡åˆ°è¿™é‡Œ -->
            <p style="text-align:center; color:#999; margin-top:50px;">è´­ç‰©è½¦æ˜¯ç©ºçš„</p>
        </div>

        <div class="cart-footer">
            <div class="total-price">
                <span>æ€»è®¡:</span>
                <span id="cart-total">$0</span>
            </div>

            <!-- æ–°å¢ï¼šç›´æ¥æ˜¾ç¤ºè¡¨å•ï¼Œä¸å†å¼¹ prompt -->
            <div id="checkout-form" style="margin-top: 15px;">
                <input type="text" id="cust-name" placeholder="æ‚¨çš„å§“å"
                    style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:5px;">
                <input type="text" id="cust-addr" placeholder="æ”¶è´§åœ°å€"
                    style="width:100%; padding:10px; margin-bottom:10px; border:1px solid #ddd; border-radius:5px;">
                <button class="checkout-btn" onclick="submitOrder()">ğŸ’³ ç«‹å³æ”¯ä»˜</button>
            </div>
        </div>
    </div>
    <!-- é®ç½©å±‚ (ç‚¹èƒŒæ™¯å…³é—­è´­ç‰©è½¦) -->
    <div id="cart-overlay" class="cart-overlay" onclick="toggleCart()"></div>
    <!-- ==================== è¿™é‡Œæ˜¯ JS é€»è¾‘åŒºåŸŸ ==================== -->
    <script>
        // =================é…ç½®åŒºåŸŸ=================
        // åœ¨ script é¡¶éƒ¨å®šä¹‰
        // const BASE_URL = 'http://localhost:5000'; // æœ¬åœ°å¼€å‘ç”¨è¿™ä¸ª
        const BASE_URL = 'https://palado-backend1.onrender.com'; // ä¸Šçº¿ç”¨è¿™ä¸ª

        const API_URL = `${BASE_URL}/api/products`;
        const ORDER_URL = `${BASE_URL}/api/orders`;

        const productGrid = document.getElementById('product-grid');
        let cart = JSON.parse(localStorage.getItem('myCart')) || [];

        // ğŸŒŸ æ–°å¢ï¼šå…¨å±€å˜é‡ï¼Œç”¨æ¥å­˜â€œæ‰€æœ‰é‹å­â€çš„åŸå§‹æ•°æ®
        let allProductsData = [];

        // ================= 1. å¯åŠ¨é€»è¾‘ =================
        document.addEventListener('DOMContentLoaded', () => {
            fetchProducts();
            checkPaymentStatus();
            updateCartUI();
        });
        // æ–°å¢å‡½æ•°ï¼šæ£€æŸ¥ URL å‚æ•°
        // æ£€æŸ¥ URL å‚æ•° (å¤„ç†æ”¯ä»˜å›è°ƒ)
        async function checkPaymentStatus() { // ğŸ‘ˆ æ³¨æ„ï¼šè¿™é‡ŒåŠ äº† async
            const urlParams = new URLSearchParams(window.location.search);

            if (urlParams.get('status') === 'success') {

                // ğŸ›‘ æ ¸å¿ƒä¿®å¤æ­¥éª¤ï¼šæ”¯ä»˜æˆåŠŸäº†ï¼Œå…ˆå‘Šè¯‰åç«¯å­˜å…¥æ•°æ®åº“ï¼
                // å› ä¸ºç›®å‰ Stripe æ¨¡å¼ä¸è¿”å›åœ°å€ï¼Œæˆ‘ä»¬å…ˆè‡ªåŠ¨å¡«å…¥ "Stripeçº¿ä¸Šè®¢å•"
                // è¿™æ ·æ•°æ®åº“å°±ä¸ä¼šæŠ¥é”™è¯´â€œç¼ºåå­—ã€ç¼ºåœ°å€â€äº†

                // 1. ç®—å‡ºæ€»ä»·
                const total = cart.reduce((sum, item) => sum + item.price, 0);

                // 2. å‡†å¤‡æ•°æ®
                const orderData = {
                    customerName: "Stripe é¡¾å®¢", // æš‚æ—¶ç”¨é€šç”¨åï¼Œä»¥åå¯ä»¥ç”¨ Stripe Webhook è·å–çœŸå
                    address: "Stripe çº¿ä¸Šæ”¯ä»˜",  // æš‚æ—¶ç”¨é€šç”¨åœ°å€
                    items: cart,                 // è´­ç‰©è½¦é‡Œçš„ä¸œè¥¿
                    totalPrice: total            // æ€»ä»·
                };

                try {
                    // 3. å‘é€ç»™åç«¯ä¿å­˜
                    // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨çš„æ˜¯ api/orders æ¥å£ï¼Œä¸æ˜¯ Stripe æ¥å£
                    await fetch(`${BASE_URL}/api/orders`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(orderData)
                    });

                    alert("ğŸ‰ æ”¯ä»˜æˆåŠŸï¼è®¢å•å·²æˆåŠŸåŒæ­¥åˆ°åå°ï¼");

                } catch (err) {
                    console.error("è®¢å•ä¿å­˜å¤±è´¥:", err);
                    alert("æ”¯ä»˜æˆåŠŸï¼Œä½†è®¢å•ä¿å­˜å‡ºç‚¹å°é”™ï¼Œè¯·è”ç³»å®¢æœã€‚");
                }

                // 4. ä¸€åˆ‡æå®šåï¼Œå†æ¸…ç©ºè´­ç‰©è½¦
                cart = [];
                localStorage.removeItem('myCart');
                updateCartUI();

                // è®©åœ°å€æ å˜å¹²å‡€
                window.history.replaceState({}, document.title, window.location.pathname);
            }
            else if (urlParams.get('status') === 'cancel') {
                alert("qaq æ‚¨å–æ¶ˆäº†æ”¯ä»˜ï¼Œå•†å“è¿˜åœ¨è´­ç‰©è½¦é‡Œç­‰ç€æ‚¨å“¦ï¼");
            }
        }
        // ================= 2. è·å–æ•°æ® (ç¨å¾®æ”¹ä¸€ç‚¹ç‚¹) =================
        async function fetchProducts() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("è¿æ¥åç«¯å¤±è´¥");

                // æ‹¿åˆ°æ•°æ®
                const products = await response.json();

                // ğŸŒŸ å…³é”®åŠ¨ä½œï¼šæŠŠæ•°æ®å­˜è¿›â€œæ€»è´¦æœ¬â€
                allProductsData = products;

                // ä¸€å¼€å§‹æ˜¾ç¤ºæ‰€æœ‰äº§å“
                renderProducts(products);

            } catch (error) {
                console.error(error);
                productGrid.innerHTML = `<p style="text-align:center;">âš ï¸ æ•°æ®åŠ è½½å¤±è´¥</p>`;
            }
        }

        // ================= ğŸŒŸ æ–°å¢ï¼šç­›é€‰ä¸æœç´¢åŠŸèƒ½ =================

        // A. æŒ‰åˆ†ç±»ç­›é€‰ (ç‚¹å¯¼èˆªæ æŒ‰é’®æ—¶è§¦å‘)
        function filterProducts(category) {
            // 1. åˆ‡æ¢æŒ‰é’®çš„â€œåŠ ç²—â€çŠ¶æ€ (è§†è§‰æ•ˆæœ)
            document.querySelectorAll('.nav-links a').forEach(el => el.classList.remove('active'));
            document.getElementById(`btn-${category}`).classList.add('active');

            // 2. ç­›é€‰æ•°æ®
            if (category === 'all') {
                // å¦‚æœé€‰å…¨éƒ¨ï¼Œå°±ç»™æ‰€æœ‰æ•°æ®
                renderProducts(allProductsData);
            } else {
                // å¦åˆ™ï¼Œåªç•™ä¸‹ category ç­‰äº ç›®æ ‡åˆ†ç±» çš„é‹å­
                const filtered = allProductsData.filter(item => item.category === category);
                renderProducts(filtered);
            }
        }

        // B. æœç´¢åŠŸèƒ½ (è¾“å…¥æ–‡å­—æ—¶è§¦å‘)
        function handleSearch() {
            const keyword = document.getElementById('search-input').value.toLowerCase(); // è½¬å°å†™ï¼Œä¸åŒºåˆ†å¤§å°å†™

            // åœ¨åå­—é‡Œæ‰¾å…³é”®è¯
            const searched = allProductsData.filter(item =>
                item.name.toLowerCase().includes(keyword)
            );

            renderProducts(searched);
        }

        // ================= 3. æ¸²æŸ“å•†å“ =================
        function renderProducts(products) {
            productGrid.innerHTML = '';
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'product-card';
                // æ³¨æ„ï¼šä¸‹é¢çš„ button onclick äº‹ä»¶å˜äº†
                // æˆ‘ä»¬æŠŠæ•´ä¸ª product å¯¹è±¡å˜æˆäº†å­—ç¬¦ä¸²ä¼ è¿›å»ï¼Œæ–¹ä¾¿è¯»å–
                const productStr = JSON.stringify(product).replace(/"/g, '&quot;');

                card.innerHTML = `
                    <div style="background:#eee; border-radius:10px; overflow:hidden; height:250px;">
                        <img src="${product.img}" alt="${product.name}" style="width:100%; height:100%; object-fit:cover;">
                    </div>
                    <div style="padding:15px 0; display:flex; justify-content:space-between; align-items:center;">
                        <h3 style="font-size:1.1rem; margin:0; font-weight:700;">${product.name}</h3>
                        <span style="color:#3b5bdb; font-weight:bold; font-size:1.2rem;">$${product.price}</span>
                    </div>
                    <button onclick="addToCart('${product._id}')">åŠ å…¥è´­ç‰©è½¦</button>
                    
                    åŠ å…¥è´­ç‰©è½¦
                    </button>
                `;
                productGrid.appendChild(card);
            });
        }

        // ================= 4. ğŸ›’ è´­ç‰©è½¦æ ¸å¿ƒé€»è¾‘ (é‡ç‚¹ï¼) =================

        // A. æ·»åŠ åˆ°è´­ç‰©è½¦
        function addToCart(id) {
            // åœ¨æ€»æ•°æ®é‡Œæ‰¾åˆ°è¿™ä¸ªå•†å“
            const targetProduct = allProductsData.find(item => item._id === id);
            if (targetProduct) {
                cart.push(targetProduct);
                saveCart();
                updateCartUI();
                toggleCart();
            }
        }

        // B. ä»è´­ç‰©è½¦ç§»é™¤ (æ ¹æ®ç´¢å¼• index)
        function removeFromCart(index) {
            cart.splice(index, 1); // åˆ æ‰ç¬¬å‡ ä¸ª
            saveCart();
            updateCartUI();
        }

        // C. ä¿å­˜æ•°æ® (æŒä¹…åŒ–)
        function saveCart() {
            // localStorage åªèƒ½å­˜å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦ JSON.stringify
            localStorage.setItem('myCart', JSON.stringify(cart));
        }

        // D. æ›´æ–°ç•Œé¢ (ç”»å‡ºä¾§è¾¹æ çš„å†…å®¹)
        function updateCartUI() {
            // 1. æ›´æ–°å³ä¸Šè§’çš„æ•°å­—
            const navRight = document.querySelector('.nav-right span');
            navRight.innerText = `CART (${cart.length})`;
            // ç»™æ–‡å­—åŠ ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å®ƒä¹Ÿèƒ½æ‰“å¼€è´­ç‰©è½¦
            navRight.style.cursor = 'pointer';
            navRight.onclick = toggleCart;

            // 2. æ›´æ–°ä¾§è¾¹æ é‡Œçš„åˆ—è¡¨
            const cartItemsContainer = document.getElementById('cart-items');
            const cartTotalElement = document.getElementById('cart-total');

            cartItemsContainer.innerHTML = ''; // å…ˆæ¸…ç©º
            let totalPrice = 0;

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<p style="text-align:center; color:#999; margin-top:20px;">ç©ºç©ºå¦‚ä¹Ÿ...</p>';
            } else {
                cart.forEach((item, index) => {
                    totalPrice += item.price; // ç´¯åŠ ä»·æ ¼
                    cartItemsContainer.innerHTML += `
                        <div class="cart-item">
                            <img src="${item.img}">
                            <div class="cart-item-info">
                                <h4>${item.name}</h4>
                                <div>$${item.price}</div>
                            </div>
                            <div class="cart-remove" onclick="removeFromCart(${index})">åˆ é™¤</div>
                        </div>
                    `;
                });
            }

            // 3. æ›´æ–°æ€»ä»·
            cartTotalElement.innerText = '$' + totalPrice;
        }

        // E. å¼€å…³ä¾§è¾¹æ åŠ¨ç”»
        function toggleCart() {
            const sidebar = document.getElementById('cart-sidebar');
            const overlay = document.getElementById('cart-overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('open');
        }
        // ================= 5. ğŸ’³ Stripe æ”¯ä»˜åŠŸèƒ½ (æ–°ç‰ˆ) =================

        // 1. åˆå§‹åŒ– Stripe (ä½¿ç”¨åˆšæ‰ä½ å‘çš„å…¬é’¥)
        const stripe = Stripe('pk_test_51SYdsIQr6341tjDEOCmUjmguA4yTzcOIfcaR0x7Ohya7HFRjV0lsuLHJJeOVUV6pMpdnMo5tTNR0ACUAvi75LqUN009LfHTz2w');

        async function submitOrder() {
            if (cart.length === 0) return alert("è´­ç‰©è½¦æ˜¯ç©ºçš„ï¼Œæ— æ³•ç»“è´¦ï¼");

            // ç»™ç”¨æˆ·ä¸€ä¸ªåé¦ˆï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            const checkoutBtn = document.querySelector('.checkout-btn');
            checkoutBtn.innerText = "â³ æ­£åœ¨è·³è½¬æ”¯ä»˜...";
            checkoutBtn.disabled = true;

            try {
                // 2. è¯·æ±‚åç«¯åˆ›å»ºä¸€ä¸ªâ€œæ”¯ä»˜ä¼šè¯â€
                // æ³¨æ„ï¼šå¦‚æœä½ æ˜¯åœ¨æœ¬åœ°æµ‹è¯•ï¼Œç¡®ä¿ API_URL æŒ‡å‘ http://localhost:5000/api/products çš„é‚£ä¸ªå‰ç¼€
                // è¿™é‡Œæˆ‘ä»¬è¦è®¿é—® /create-checkout-session
                const response = await fetch(`${BASE_URL}/api/create-checkout-session`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ items: cart }) // æŠŠè´­ç‰©è½¦å‘ç»™åç«¯
                });

                const session = await response.json();

                // 3. å¦‚æœåç«¯æŠ¥é”™äº†
                if (session.error) {
                    alert("åˆ›å»ºæ”¯ä»˜å¤±è´¥: " + session.error);
                    checkoutBtn.innerText = "ğŸ’³ ç¡®è®¤æ”¯ä»˜";
                    checkoutBtn.disabled = false;
                    return;
                }

                // 4. åç«¯è¿”å› session.id åï¼Œè®© Stripe å¸®æˆ‘ä»¬è·³è½¬é¡µé¢
                const result = await stripe.redirectToCheckout({ sessionId: session.id });

                if (result.error) {
                    alert(result.error.message);
                }

            } catch (err) {
                console.error("æ”¯ä»˜é”™è¯¯:", err);
                alert("æ— æ³•è¿æ¥åˆ°æ”¯ä»˜æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥åç«¯æ˜¯å¦å¯åŠ¨ï¼");
                checkoutBtn.innerText = "ğŸ’³ ç¡®è®¤æ”¯ä»˜";
                checkoutBtn.disabled = false;
            }
        }
    </script>

</body>

</html>